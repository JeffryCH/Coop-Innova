<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Solicitar Crédito - Coop-Innova</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/estilo.css">
</head>

<body class="bg-light">
  <div id="loader-bg"><div class="loader-spinner"></div></div>

  <!-- Navbar importado -->
  <div id="navbar"></div>
  
  <!-- Modal de conversión importado -->
  <div id="modal-conversion-container"></div>

  <div class="container pt-5 mt-5">
    <h2 class="text-center text-primary mb-4">Solicitar Crédito</h2>
    <div id="solicitud-credito-container"></div>
  </div>
  <div id="footer" class="mt-5"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/includes.js"></script>
  <script>
    async function mostrarFormularioCredito() {
      const sesion = await fetch('php/session.php', { credentials: 'include' }).then(r => r.json());
      const cont = document.getElementById('solicitud-credito-container');
      if (!sesion.user || !sesion.user.id) {
        cont.innerHTML = `<div class='alert alert-warning'>Debes iniciar sesión para solicitar un crédito.</div>`;
        return;
      }
      cont.innerHTML = `
        <form id='form-solicitar-credito' class='card p-3 mb-3'>
          <h5 class='mb-3'>Solicitar Crédito</h5>
          <div class='mb-3'>
            <label for='monto' class='form-label'>Monto solicitado</label>
            <input type='number' class='form-control' id='monto' name='monto' min='1000' step='0.01' required>
          </div>
          <button type='submit' class='btn btn-primary'>Solicitar crédito</button>
          <div id='mensaje-credito' class='mt-3'></div>
        </form>
      `;
      document.getElementById('form-solicitar-credito').onsubmit = async function(e) {
        e.preventDefault();
        const monto = document.getElementById('monto').value;
        const res = await fetch('php/solicitar_credito.php', {
          method: 'POST',
          credentials: 'include',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `monto=${encodeURIComponent(monto)}`
        });
        const data = await res.json();
        document.getElementById('mensaje-credito').textContent = data.success
          ? 'Solicitud enviada correctamente.'
          : (data.error || 'Error al enviar solicitud.');
        if (data.success) document.getElementById('form-solicitar-credito').reset();
      };
    }
    document.addEventListener('DOMContentLoaded', mostrarFormularioCredito);
  </script>
</body>
</html>
