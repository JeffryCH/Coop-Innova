<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">🏦 Coop-Innova</a>
    
    <!-- Tipo de cambio en navbar -->
    <div id="tipo-cambio-navbar" class="d-flex align-items-center ms-3" style="font-size:0.85rem;">
      <div class="tipo-cambio-container d-flex gap-3">
        <div class="tipo-cambio-item" style="background:#e3f2fd; padding:4px 8px; border-radius:8px; border:1px solid #1976d2;">
          <span style="color:#1976d2; font-weight:600;">💵 USD:</span>
          <span id="navbar-usd-compra" style="color:#2e7d32; font-weight:500;">--</span> /
          <span id="navbar-usd-venta" style="color:#d32f2f; font-weight:500;">--</span>
        </div>
        <div class="tipo-cambio-item" style="background:#f3e5f5; padding:4px 8px; border-radius:8px; border:1px solid #7b1fa2;">
          <span style="color:#7b1fa2; font-weight:600;">💶 EUR:</span>
          <span id="navbar-eur-compra" style="color:#2e7d32; font-weight:500;">--</span> /
          <span id="navbar-eur-venta" style="color:#d32f2f; font-weight:500;">--</span>
        </div>
        <button id="btn-conversor" class="btn btn-sm btn-outline-primary" style="padding:2px 8px; font-size:0.8rem;" onclick="abrirConversor()">
          💱 Convertir
        </button>
      </div>
    </div>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse" id="menu">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">🏠 Inicio</a></li>
        <li class="nav-item"><a class="nav-link" href="servicios.html">🛠️ Servicios</a></li>
        <li class="nav-item"><a class="nav-link" href="solicitar_credito.html">💳 Solicitar Crédito</a></li>
        <li class="nav-item"><a class="nav-link" href="movimientos.html">💰 Movimientos</a></li>
        <li class="nav-item"><a class="nav-link" href="ver_perfil.html">👤 Ver Perfil</a></li>
        <li class="nav-item"><a class="nav-link" href="tipo-cambio.html">💱 Tipo de Cambio</a></li>
        <li class="nav-item"><a class="nav-link" href="registro.html">📝 Registro</a></li>
        <li class="nav-item"><a class="nav-link" href="contacto.html">📞 Contacto</a></li>
        <li class="nav-item">
          <button class="btn btn-primary btn-sm ms-2" onclick="abrirConversor()">🔄 Conversor</button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Estilos para el navbar -->
<style>
.tipo-cambio-container {
  animation: fadeIn 1s ease-in;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Responsive design */
@media (max-width: 768px) {
  #tipo-cambio-navbar {
    display: none !important;
  }
}
</style>

<!-- Script para tipo de cambio -->
<script>
console.log('🚀 Script de navbar cargando...');

// Variables globales
window.tipoCambioNavbar = {
  usd: { compra: 0, venta: 0 },
  eur: { compra: 0, venta: 0 }
};

// Función principal de actualización
async function actualizarTipoCambio() {
  console.log('🔄 [NAVBAR] Iniciando actualización...');
  
  try {
    // Verificar que los elementos existen
    const elementos = {
      usdCompra: document.getElementById('navbar-usd-compra'),
      usdVenta: document.getElementById('navbar-usd-venta'),
      eurCompra: document.getElementById('navbar-eur-compra'),
      eurVenta: document.getElementById('navbar-eur-venta')
    };
    
    console.log('🎯 [NAVBAR] Verificando elementos DOM...');
    for (const [key, elem] of Object.entries(elementos)) {
      console.log(`   ${key}:`, elem ? '✅ OK' : '❌ NO ENCONTRADO');
    }
    
    // Si algún elemento no existe, reintentar en 1 segundo
    if (Object.values(elementos).some(elem => !elem)) {
      console.warn('⚠️ [NAVBAR] Algunos elementos no están listos, reintentando...');
      setTimeout(actualizarTipoCambio, 1000);
      return;
    }
    
    // Obtener datos de la API
    console.log('🌐 [NAVBAR] Consultando API...');
    const response = await fetch('/api/tipo-cambio');
    const data = await response.json();
    
    console.log('📦 [NAVBAR] Respuesta:', data);
    
    if (data && data.data && data.data.success && data.data.data) {
      const rates = data.data.data;
      
      // Actualizar USD
      elementos.usdCompra.textContent = `₡${rates.compra}`;
      elementos.usdVenta.textContent = `₡${rates.venta}`;
      
      // Calcular EUR (USD + 2%)
      const eurCompra = Math.round(rates.compra * 1.02);
      const eurVenta = Math.round(rates.venta * 1.02);
      
      elementos.eurCompra.textContent = `₡${eurCompra}`;
      elementos.eurVenta.textContent = `₡${eurVenta}`;
      
      console.log('✅ [NAVBAR] Actualizado:', {
        usd: `₡${rates.compra}/₡${rates.venta}`,
        eur: `₡${eurCompra}/₡${eurVenta}`
      });
      
    } else {
      throw new Error('Datos inválidos de la API');
    }
    
  } catch (error) {
    console.error('❌ [NAVBAR] Error:', error);
    
    // Marcar como error
    ['navbar-usd-compra', 'navbar-usd-venta', 'navbar-eur-compra', 'navbar-eur-venta'].forEach(id => {
      const elem = document.getElementById(id);
      if (elem) elem.textContent = 'N/A';
    });
  }
}

// Función para abrir conversor
function abrirConversor() {
  if (typeof mostrarModalConversion === 'function') {
    mostrarModalConversion();
  } else {
    window.location.href = 'tipo-cambio.html';
  }
}

// Inicialización
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    console.log('📋 [NAVBAR] DOM ready, iniciando...');
    setTimeout(actualizarTipoCambio, 500);
  });
} else {
  console.log('📋 [NAVBAR] DOM ya listo, iniciando inmediatamente...');
  setTimeout(actualizarTipoCambio, 100);
}

// Función global para forzar actualización
window.forzarActualizacionNavbar = actualizarTipoCambio;

// Actualizar cada 5 minutos
setInterval(actualizarTipoCambio, 5 * 60 * 1000);

console.log('✅ [NAVBAR] Script configurado');
</script>
