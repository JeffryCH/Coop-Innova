<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Historial de Créditos - Coop-Innova</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/estilo.css">
</head>
<body class="bg-light">
  <div id="navbar"></div>
  <div class="container pt-5 mt-5">
    <h2 class="text-center text-primary mb-4">Historial de Créditos</h2>
    <div id="creditos-contenido"></div>
  </div>
  <div id="footer" class="mt-5"></div>
  <script src="js/includes.js"></script>
  <script>
    async function cargarHistorialCreditos() {
      const cont = document.getElementById('creditos-contenido');
      cont.innerHTML = '<div class="text-center py-3"><div class="spinner-border text-primary" role="status"></div><div class="mt-2">Cargando historial...</div></div>';
      let sesion;
      try {
        sesion = await fetch('php/session.php', { credentials: 'include' }).then(r => r.json());
      } catch (e) { sesion = { user: null }; }
      if (!sesion.user || !sesion.user.id) {
        cont.innerHTML = '<div class="alert alert-warning">Debes iniciar sesión para ver tu historial de créditos.</div>';
        return;
      }
      try {
        const resp = await fetch('php/historial_creditos.php', { credentials: 'include' });
        const data = await resp.json();
        if (!data.success || !data.creditos || data.creditos.length === 0) {
          cont.innerHTML = '<div class="alert alert-info">No tienes solicitudes de crédito registradas.</div>';
          return;
        }
        let html = `<table class='table table-bordered table-striped'><thead><tr><th>Monto</th><th>Estado</th><th>Fecha</th></tr></thead><tbody>`;
        for (const c of data.creditos) {
          html += `<tr><td>₡${parseFloat(c.monto).toLocaleString('es-CR', { minimumFractionDigits: 2 })}</td><td>${c.estado.charAt(0).toUpperCase() + c.estado.slice(1)}</td><td>${new Date(c.fecha).toLocaleString()}</td></tr>`;
        }
        html += '</tbody></table>';
        cont.innerHTML = html;
      } catch (e) {
        cont.innerHTML = '<div class="alert alert-danger">Error al cargar historial.</div>';
      }
    }
    document.addEventListener('DOMContentLoaded', cargarHistorialCreditos);
  </script>
</body>
</html>
